# handles requests to profile static server for images
location /profile/a/ {
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header Host $http_host;
  proxy_redirect off;
  rewrite ^/profile(.*)$ $1 break;
  proxy_pass http://upstream_profile_static_server;
}

# handles all other request to the profile api
location /profile/ {
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header Host $http_host;
  proxy_redirect off;
  rewrite ^/profile(.*)$ $1 break;
  proxy_pass http://upstream_profile_server;
}
